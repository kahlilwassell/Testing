# Annotation Job API

This Python application provides an API for submitting, tracking, and retrieving the status of annotation jobs. It is implemented using Flask and manages jobs through a filesystem-based persistence mechanism.

---

## Features
1. **Submit Annotation Jobs**:
   - Accepts a file name as input, generates a unique job ID, and processes the file with an annotation script.
   - Supports concurrent requests and ensures unique job tracking.
   
2. **Track Job Status**:
   - Retrieve the current status of an annotation job using its unique job ID.
   - Status values: `pending`, `running`, or `complete`.

3. **List All Jobs**:
   - Fetch a list of all annotation jobs submitted to the system.
   - Provides URLs to retrieve detailed information for each job.

---

## Endpoints

### 1. **Submit a Job**
   - **Endpoint**: `POST /annotations`
   - **Request Body**:
     ```json
     {
         "input_file": "example.vcf"
     }
     ```
   - **Response**:
     - **Success**:
       ```json
       {
           "code": 201,
           "status": "success",
           "data": {
               "job_id": "unique-job-id",
               "input_file": "example.vcf"
           }
       }
       ```
     - **Error**:
       ```json
       {
           "code": 400,
           "status": "error",
           "message": "No 'input_file' specified in the request body."
       }
       ```
       - Additional error scenarios include invalid file paths or failures to create necessary resources.

---

### 2. **Get Job Status**
   - **Endpoint**: `GET /annotations/<job_id>`
   - **Response**:
     - **Running Job**:
       ```json
       {
           "code": 200,
           "status": "success",
           "data": {
               "job_id": "unique-job-id",
               "job_status": "running"
           }
       }
       ```
     - **Completed Job**:
       ```json
       {
           "code": 200,
           "status": "success",
           "data": {
               "job_id": "unique-job-id",
               "job_status": "complete",
               "log": "logs from job"
           }
       }
       ```
     - **Error**:
       - Invalid `job_id`:
         ```json
         {
             "code": 404,
             "status": "error",
             "message": "No file found for /path/to/job."
         }
         ```

---

### 3. **List All Jobs**
   - **Endpoint**: `GET /annotations`
   - **Response**:
     ```json
     {
         "code": 200,
         "status": "success",
         "data": {
             "jobs": [
                 {
                     "job_id": "job-id-1",
                     "job_details": "http://<your-base-url>/annotations/job-id-1"
                 },
                 {
                     "job_id": "job-id-2",
                     "job_details": "http://<your-base-url>/annotations/job-id-2"
                 }
             ]
         }
     }
     ```
   - **Error**:
     ```json
     {
         "code": 500,
         "status": "error",
         "message": "Failed to retrieve jobs.",
         "error": "Detailed error message."
     }
     ```

---

## Directory Structure
- **Data Directory**:
  - Each job's data and status are stored in the `~/anntools/data/` directory:
    ```
    ~/anntools/data/
        ├── <job_id>.txt         # Tracks the status of the job (e.g., "pending", "running", "complete")
        ├── <job_id>.vcf         # Input file copied for the job
        ├── <job_id>.annot.vcf   # Annotated output file (generated when complete)
        ├── <job_id>.vcf.count.log # Log file generated by the annotator
    ```

---

## Error Handling
1. **Missing Input Files**:
   - Missing `input_file` in `POST /annotations` results in:
     ```json
     {
         "code": 400,
         "status": "error",
         "message": "No 'input_file' specified in the request body."
     }
     ```

2. **Invalid Job IDs**:
   - Accessing `GET /annotations/<job_id>` with an invalid or non-existent `job_id` returns:
     ```json
     {
         "code": 404,
         "status": "error",
         "message": "No file found for /path/to/job."
     }
     ```

3. **Filesystem or Subprocess Errors**:
   - If the system encounters issues with file creation, directory listing, or subprocess invocation, it returns a `500` error with details.

---

## How to Access
I left a t4g.nano instance with ip 34.235.139.53 running with a tmux process set. The API is available for the above requests at.
http://kjwassell-a4.ucmpcs.org:5000/annotations/
Here are example requests for both the list and the get job status by id endpoints.
http://kjwassell-a4.ucmpcs.org:5000/annotations/
http://kjwassell-a4.ucmpcs.org:5000/annotations/095a9590-1d83-407e-8ed6-a12fc10e01fe